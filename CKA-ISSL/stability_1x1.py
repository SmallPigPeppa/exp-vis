import numpy as np
import matplotlib.pyplot as plt

joint = [[1.0] * 9] * 9

fix = [[1.0] * 51] * 51

finetune = [
    [0.99443287, 0.9780806, 0.9780806, 0.9816676, 0.9847656, 0.9847656, 0.99236, 0.9855791, 0.9816676, 0.9551865,
     0.977579, 0.977579, 0.9530839, 0.92737997, 0.9551865, 0.9400567, 0.926113, 0.926113, 0.9305231, 0.94235975,
     0.9400567, 0.8995645, 0.913004, 0.913004, 0.9167423, 0.92371947, 0.8995645, 0.8577568, 0.8452685, 0.8452685,
     0.839898, 0.8389433, 0.8577568, 0.7999936, 0.83357185, 0.83357185, 0.7438135, 0.7530682, 0.7999936, 0.81636393,
     0.82672143, 0.82672143, 0.85434204, 0.8550276, 0.81636393, 0.6336205, 0.77034014, 0.77034014, 0.7926455,
     0.79464316, 0.6336205],
    [0.9973775, 0.9823759, 0.9823759, 0.9849783, 0.9893342, 0.9893342, 0.99342877, 0.98740774, 0.9849783, 0.9472675,
     0.9744679, 0.9744679, 0.9535435, 0.9339015, 0.9472675, 0.94907564, 0.9424777, 0.9424777, 0.94679683, 0.9544454,
     0.94907564, 0.88017625, 0.89348155, 0.89348155, 0.88705045, 0.89943975, 0.88017625, 0.8619769, 0.8520611,
     0.8520611, 0.8551861, 0.85423607, 0.8619769, 0.82307774, 0.84701836, 0.84701836, 0.7693743, 0.77930987, 0.82307774,
     0.82369405, 0.83367485, 0.83367485, 0.84732634, 0.8475738, 0.82369405, 0.6334275, 0.77197593, 0.77197593,
     0.7989647, 0.80039877, 0.6334275],
    [0.99422336, 0.9759857, 0.9759857, 0.9773976, 0.9693276, 0.9693276, 0.9917614, 0.9848087, 0.9773976, 0.9449558,
     0.97396725, 0.97396725, 0.94253373, 0.90190494, 0.9449558, 0.94187474, 0.93109447, 0.93109447, 0.9310324,
     0.93921286, 0.94187474, 0.88081586, 0.8974018, 0.8974018, 0.89495164, 0.9057391, 0.88081586, 0.8280508, 0.8210895,
     0.8210895, 0.801591, 0.8021495, 0.8280508, 0.76422983, 0.8005815, 0.8005815, 0.7093965, 0.71972597, 0.76422983,
     0.76057225, 0.7684823, 0.7684823, 0.7925917, 0.79474914, 0.76057225, 0.5866382, 0.70486194, 0.70486194, 0.75888973,
     0.7625069, 0.5866382],
    [0.992133, 0.973894, 0.973894, 0.9828952, 0.97613496, 0.97613496, 0.9923219, 0.98351955, 0.9828952, 0.9562942,
     0.98275054, 0.98275054, 0.96844506, 0.92898744, 0.9562942, 0.9502972, 0.9341354, 0.9341354, 0.94080204, 0.94683665,
     0.9502972, 0.8658877, 0.86806285, 0.86806285, 0.84957314, 0.8689328, 0.8658877, 0.83586806, 0.8223725, 0.8223725,
     0.82209, 0.82144606, 0.83586806, 0.7767672, 0.8168927, 0.8168927, 0.74015915, 0.751583, 0.7767672, 0.7869914,
     0.79305947, 0.79305947, 0.8009191, 0.8034095, 0.7869914, 0.61565375, 0.7568352, 0.7568352, 0.78937876, 0.7927709,
     0.61565375],
    [0.99140626, 0.97264886, 0.97264886, 0.97874844, 0.9775056, 0.9775056, 0.9912307, 0.98358566, 0.97874844, 0.9409309,
     0.97080845, 0.97080845, 0.94218075, 0.8912251, 0.9409309, 0.9324387, 0.91867846, 0.91867846, 0.92407084,
     0.92909855, 0.9324387, 0.86586493, 0.871413, 0.871413, 0.8470128, 0.8648188, 0.86586493, 0.81010324, 0.80339557,
     0.80339557, 0.7646459, 0.76722705, 0.81010324, 0.7227572, 0.77409965, 0.77409965, 0.6787627, 0.68822163, 0.7227572,
     0.70341325, 0.70025134, 0.70025134, 0.7062609, 0.7078466, 0.70341325, 0.6194678, 0.67405474, 0.67405474, 0.6790865,
     0.6840577, 0.6194678],
    [0.9952938, 0.9819486, 0.9819486, 0.9789314, 0.9838202, 0.9838202, 0.9929916, 0.9891555, 0.9789314, 0.9506717,
     0.973641, 0.973641, 0.950426, 0.9376592, 0.9506717, 0.94877136, 0.9366079, 0.9366079, 0.9401077, 0.9494463,
     0.94877136, 0.902929, 0.92103946, 0.92103946, 0.9254835, 0.9297152, 0.902929, 0.8741723, 0.8600732, 0.8600732,
     0.83869725, 0.83676505, 0.8741723, 0.80548006, 0.83984053, 0.83984053, 0.7361049, 0.74388254, 0.80548006,
     0.8114924, 0.82316697, 0.82316697, 0.84305143, 0.8437269, 0.8114924, 0.66772795, 0.77526003, 0.77526003, 0.7822789,
     0.78615934, 0.66772795],
    [0.9965231, 0.9792655, 0.9792655, 0.98519623, 0.98630154, 0.98630154, 0.9948329, 0.99161947, 0.98519623, 0.9473429,
     0.9740855, 0.9740855, 0.9450172, 0.9163133, 0.9473429, 0.93439263, 0.9189001, 0.9189001, 0.91646254, 0.9294676,
     0.93439263, 0.8786333, 0.9004827, 0.9004827, 0.89736164, 0.9033929, 0.8786333, 0.8432904, 0.83022964, 0.83022964,
     0.824182, 0.82158494, 0.8432904, 0.792066, 0.826046, 0.826046, 0.7508181, 0.7590188, 0.792066, 0.7927251,
     0.8042115, 0.8042115, 0.827061, 0.8274367, 0.7927251, 0.6253167, 0.74054515, 0.74054515, 0.76982874, 0.77330476,
     0.6253167],
    [0.9924947, 0.9784783, 0.9784783, 0.97678024, 0.96522963, 0.96522963, 0.991207, 0.9846446, 0.97678024, 0.95402294,
     0.97897255, 0.97897255, 0.9558878, 0.90920657, 0.95402294, 0.9400563, 0.92572874, 0.92572874, 0.9300964,
     0.93821174, 0.9400563, 0.87187564, 0.8864196, 0.8864196, 0.8781703, 0.8900275, 0.87187564, 0.82426023, 0.8154432,
     0.8154432, 0.7949304, 0.79423535, 0.82426023, 0.768237, 0.7978808, 0.7978808, 0.73769206, 0.74500453, 0.768237,
     0.75808686, 0.7703356, 0.7703356, 0.80265206, 0.8044617, 0.75808686, 0.59847623, 0.72525847, 0.72525847, 0.7918291,
     0.7935065, 0.59847623],
    [0.99569106, 0.97704965, 0.97704965, 0.98144937, 0.97889197, 0.97889197, 0.9947133, 0.98953134, 0.98144937,
     0.94545907, 0.9751652, 0.9751652, 0.94210464, 0.9147108, 0.94545907, 0.94548047, 0.9358681, 0.9358681, 0.93386143,
     0.9402145, 0.94548047, 0.883302, 0.893756, 0.893756, 0.876538, 0.88973373, 0.883302, 0.83420956, 0.8287644,
     0.8287644, 0.8037901, 0.8030788, 0.83420956, 0.7481281, 0.7879641, 0.7879641, 0.6928721, 0.7059966, 0.7481281,
     0.7518822, 0.75949985, 0.75949985, 0.77252746, 0.7741872, 0.7518822, 0.58857167, 0.71757764, 0.71757764, 0.7753349,
     0.779079, 0.58857167],
    [0.99520135, 0.9743528, 0.9743528, 0.980899, 0.9750836, 0.9750836, 0.9929148, 0.98569983, 0.980899, 0.9544948,
     0.9804346, 0.9804346, 0.9609529, 0.9331277, 0.9544948, 0.95122594, 0.9421724, 0.9421724, 0.94375706, 0.95210487,
     0.95122594, 0.87618804, 0.89200085, 0.89200085, 0.88632965, 0.8997021, 0.87618804, 0.84273225, 0.83779436,
     0.83779436, 0.84789956, 0.8482107, 0.84273225, 0.78944737, 0.8180277, 0.8180277, 0.7545991, 0.762642, 0.78944737,
     0.8011672, 0.811936, 0.811936, 0.8324706, 0.83448225, 0.8011672, 0.65114415, 0.75476927, 0.75476927, 0.81563634,
     0.81873065, 0.65114415]]
reparam = [
    [1.0, 0.99947387, 0.99947387, 0.99865574, 0.9955072, 0.9955072, 0.9955726, 0.9898514, 0.99865574, 0.9962816,
     0.99372596, 0.99372596, 0.9935273, 0.9947307, 0.9962816, 0.99500346, 0.99316853, 0.99316853, 0.9933641, 0.99300647,
     0.99500346, 0.99245054, 0.9940698, 0.9940698, 0.9953634, 0.99542713, 0.99245054, 0.9874637, 0.9880233, 0.9880233,
     0.9844272, 0.9853884, 0.9874637, 0.98188126, 0.9813943, 0.9813943, 0.98130053, 0.98012173, 0.98188126, 0.97383463,
     0.97394955, 0.97394955, 0.9720642, 0.9721645, 0.97383463, 0.95391876, 0.9712852, 0.9712852, 0.9597068, 0.96070594,
     0.95391876],
    [1.0, 0.99948764, 0.99948764, 0.9985906, 0.9968545, 0.9968545, 0.99693835, 0.99339104, 0.9985906, 0.9962857,
     0.9946061, 0.9946061, 0.9952222, 0.99435997, 0.9962857, 0.99483097, 0.9929227, 0.9929227, 0.9942191, 0.9940141,
     0.99483097, 0.9911718, 0.99391466, 0.99391466, 0.9952527, 0.99514306, 0.9911718, 0.9885209, 0.98848367, 0.98848367,
     0.9866378, 0.98733234, 0.9885209, 0.98400015, 0.9836003, 0.9836003, 0.9863286, 0.9843468, 0.98400015, 0.9792614,
     0.9786715, 0.9786715, 0.97825354, 0.9781761, 0.9792614, 0.96283394, 0.97385186, 0.97385186, 0.9639099, 0.9644062,
     0.96283394],
    [1.0, 0.9992484, 0.9992484, 0.9986184, 0.99471873, 0.99471873, 0.9938051, 0.98417723, 0.9986184, 0.99597406,
     0.992795, 0.992795, 0.99289656, 0.9942273, 0.99597406, 0.99377054, 0.99095845, 0.99095845, 0.99144024, 0.9915157,
     0.99377054, 0.98781824, 0.99327856, 0.99327856, 0.994722, 0.9946927, 0.98781824, 0.98181564, 0.98214966,
     0.98214966, 0.9773399, 0.97880167, 0.98181564, 0.9779297, 0.9780488, 0.9780488, 0.98384416, 0.9818866, 0.9779297,
     0.9736906, 0.9724039, 0.9724039, 0.9706661, 0.9703747, 0.9736906, 0.9448474, 0.9640136, 0.9640136, 0.9595007,
     0.9591432, 0.9448474],
    [1.0, 0.99918574, 0.99918574, 0.9989908, 0.994637, 0.994637, 0.9945113, 0.985779, 0.9989908, 0.9966711, 0.99436086,
     0.99436086, 0.9947293, 0.99396116, 0.9966711, 0.99471873, 0.99323916, 0.99323916, 0.99411637, 0.9942183,
     0.99471873, 0.99002373, 0.994234, 0.994234, 0.9939529, 0.99381816, 0.99002373, 0.9864044, 0.9868167, 0.9868167,
     0.9826753, 0.9837479, 0.9864044, 0.98106533, 0.98166335, 0.98166335, 0.9834854, 0.9817313, 0.98106533, 0.98016703,
     0.97995573, 0.97995573, 0.97927785, 0.9790365, 0.98016703, 0.96786, 0.97633487, 0.97633487, 0.9718128, 0.97201943,
     0.96786],
    [1.0, 0.99918604, 0.99918604, 0.9987257, 0.9945413, 0.9945413, 0.99414265, 0.9859223, 0.9987257, 0.99604696,
     0.99265075, 0.99265075, 0.9920182, 0.9933157, 0.99604696, 0.99394846, 0.9920673, 0.9920673, 0.99231666, 0.99257326,
     0.99394846, 0.9894194, 0.99294204, 0.99294204, 0.99337345, 0.9933874, 0.9894194, 0.9845926, 0.9853655, 0.9853655,
     0.9803523, 0.9814312, 0.9845926, 0.9780398, 0.9799634, 0.9799634, 0.97855604, 0.9769486, 0.9780398, 0.9682053,
     0.96569633, 0.96569633, 0.9618934, 0.96226984, 0.9682053, 0.9523866, 0.95841855, 0.95841855, 0.9494908, 0.94992507,
     0.9523866],
    [1.0, 0.9995815, 0.9995815, 0.99864894, 0.9964776, 0.9964776, 0.996439, 0.99217343, 0.99864894, 0.99683934,
     0.9944905, 0.9944905, 0.9941825, 0.9954275, 0.99683934, 0.9955233, 0.99393713, 0.99393713, 0.9941959, 0.9938996,
     0.9955233, 0.9923874, 0.9944903, 0.9944903, 0.9966352, 0.9966567, 0.9923874, 0.9878825, 0.9887979, 0.9887979,
     0.98593843, 0.9868897, 0.9878825, 0.98307717, 0.9817024, 0.9817024, 0.9851338, 0.9833893, 0.98307717, 0.9671903,
     0.96814525, 0.96814525, 0.96661556, 0.966576, 0.9671903, 0.9441534, 0.9619924, 0.9619924, 0.9573135, 0.95836824,
     0.9441534],
    [1.0, 0.999499, 0.999499, 0.99893796, 0.9969771, 0.9969771, 0.9968162, 0.9913556, 0.99893796, 0.9969145, 0.9948055,
     0.9948055, 0.9947868, 0.9953607, 0.9969145, 0.99547005, 0.9932983, 0.9932983, 0.99327254, 0.99323153, 0.99547005,
     0.9922861, 0.9947287, 0.9947287, 0.9963513, 0.9961866, 0.9922861, 0.9879508, 0.98886335, 0.98886335, 0.98456436,
     0.9849433, 0.9879508, 0.9830265, 0.98328614, 0.98328614, 0.984717, 0.98305947, 0.9830265, 0.9748791, 0.9744231,
     0.9744231, 0.9717407, 0.97228897, 0.9748791, 0.95060384, 0.9664941, 0.9664941, 0.9565391, 0.957559, 0.95060384],
    [1.0, 0.99913377, 0.99913377, 0.99876136, 0.9943662, 0.9943662, 0.99349856, 0.9828579, 0.99876136, 0.9960562,
     0.992736, 0.992736, 0.9927929, 0.9950913, 0.9960562, 0.9937556, 0.99161905, 0.99161905, 0.9928648, 0.99280345,
     0.9937556, 0.9874936, 0.9924863, 0.9924863, 0.9945565, 0.9946733, 0.9874936, 0.9828727, 0.9832427, 0.9832427,
     0.9774944, 0.9788967, 0.9828727, 0.98103046, 0.9796567, 0.9796567, 0.9832158, 0.980782, 0.98103046, 0.9775058,
     0.9771205, 0.9771205, 0.97620654, 0.97648436, 0.9775058, 0.96728486, 0.97670543, 0.97670543, 0.9705091, 0.97059596,
     0.96728486],
    [1.0, 0.99929637, 0.99929637, 0.99887556, 0.9961447, 0.9961447, 0.9950254, 0.9861195, 0.99887556, 0.99619913,
     0.9938367, 0.9938367, 0.993362, 0.9937321, 0.99619913, 0.99448544, 0.9915678, 0.9915678, 0.9921578, 0.9918616,
     0.99448544, 0.98953676, 0.9939575, 0.9939575, 0.99338555, 0.9933266, 0.98953676, 0.9840891, 0.98495424, 0.98495424,
     0.9816512, 0.98251355, 0.9840891, 0.97961026, 0.980117, 0.980117, 0.9845926, 0.98278, 0.97961026, 0.9744735,
     0.97288054, 0.97288054, 0.97174305, 0.9713494, 0.9744735, 0.95775867, 0.9696328, 0.9696328, 0.9658102, 0.9667909,
     0.95775867],
    [1.0, 0.9990435, 0.9990435, 0.9986064, 0.99567497, 0.99567497, 0.99501085, 0.98735493, 0.9986064, 0.9963356,
     0.99316585, 0.99316585, 0.99399024, 0.9943921, 0.9963356, 0.99371374, 0.99188626, 0.99188626, 0.9934012, 0.9933784,
     0.99371374, 0.98832875, 0.99275494, 0.99275494, 0.9942262, 0.9940847, 0.98832875, 0.9848561, 0.9849905, 0.9849905,
     0.9827899, 0.9836198, 0.9848561, 0.9816745, 0.98122156, 0.98122156, 0.9846867, 0.9827307, 0.9816745, 0.98114944,
     0.9802271, 0.9802271, 0.9785852, 0.97858834, 0.98114944, 0.96695113, 0.9758325, 0.9758325, 0.9701872, 0.971088,
     0.96695113]]

# 将数据转换为NumPy数组
data_fix = np.array(fix)
data_finetune = np.array(finetune)
data_reparam = np.array(reparam)
data_joint = np.array(joint)

# 计算每个维度的均值和标准差
means_fix = data_fix.mean(axis=0)
std_fix = data_fix.std(axis=0)

means_finetune = data_finetune.mean(axis=0)
std_finetune = data_finetune.std(axis=0)

means_reparam = data_reparam.mean(axis=0)
std_reparam = data_reparam.std(axis=0)

means_joint = data_joint.mean(axis=0)
std_joint = data_joint.std(axis=0)

# 设置x轴数据
x = np.arange(0, len(means_fix))
fig, ax = plt.subplots(figsize=(6.66, 5))
markersize=6
fontsize1=18
fontsize2=22
plt.xticks(fontsize=fontsize1)
plt.yticks(fontsize=fontsize1)

# plt.plot(x, means_joint, '--', label='Joint', color='red', linewidth=1)
# plt.fill_between(x, np.array(means_joint) - np.array(std_joint), np.array(means_joint) + np.array(std_joint),
#                  color='red',
#                  alpha=0.2, edgecolor=None)

ax.plot(x, means_finetune, '-o', markersize=markersize,label='Fine-tune', color='yellowgreen', linewidth=1)
ax.fill_between(x, np.array(means_finetune) - np.array(std_finetune),
                 np.array(means_finetune) + np.array(std_finetune),
                 color='yellowgreen',
                 alpha=0.2, edgecolor=None)

ax.plot(x, means_fix, '-o', markersize=markersize,label='Fix', color='purple', linewidth=1)
ax.fill_between(x, np.array(means_fix) - np.array(std_fix),
                 np.array(means_fix) + np.array(std_fix),
                 color='purple',
                 alpha=0.2, edgecolor=None)
plt.plot(x, means_reparam, '-o', markersize=markersize,label='Branch-1x1', color='coral', linewidth=1)
plt.fill_between(x, np.array(means_reparam) - np.array(std_reparam),
                 np.array(means_reparam) + np.array(std_reparam),
                 color='coral',
                 alpha=0.2, edgecolor=None)

ax.set_xlabel('Layer Index', fontsize=fontsize2, )
ax.set_ylabel('CKA', fontsize=fontsize2, )
ax.set_title('Stability', loc='left', fontsize=fontsize2, )


# 显示图例
ax.legend(fontsize=fontsize1)
ax.grid()

# 显示图形

plt.savefig('result/stability-1x1.pdf', format='pdf', bbox_inches='tight')
plt.show()
